@{
    ViewData["Title"] = "Pedidos";
}

<div class="card p-4 shadow-sm border-0">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-0 text-dark"><i class="fas fa-truck-loading text-secondary me-2"></i> Pedidos</h2>
            <small class="text-muted">Historial de compras</small>
        </div>
        <a asp-action="Create" class="btn btn-primary shadow-sm">
            <i class="fas fa-cart-plus me-2"></i> Nueva Compra
        </a>
    </div>

    <div class="table-responsive">
        <table id="tablaPedidos" class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th># Pedido</th>
                    <th>Fecha</th>
                    <th>Proveedor</th>
                    <th>Estado</th>
                    <th>Total</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/js/almacen-core.js"></script>

    <script>
        const manager = new DataManager('/Pedidos/GetJson');

        const columnas = [
            { data: 'idPedido', render: (i) => `<span class="badge bg-light text-dark border">#${i.idPedido}</span>` },
            { data: 'fecha' },
            { data: 'proveedor', render: (i) => `<strong class="text-dark">${i.proveedor}</strong>` },
            { data: 'estado', render: (i) => `<span class="badge bg-success-subtle text-success border border-success">${i.estado}</span>` },
            { data: 'total', render: (i) => `<span class="fw-bold text-success">$${i.total.toFixed(2)}</span>` },
            {
                render: (i) => `
                    <div class="text-end">
                        <a href="/Pedidos/Details/${i.idPedido}" class="btn btn-sm btn-outline-secondary" title="Ver Detalles">
                            <i class="fas fa-file-invoice me-1"></i> Detalles
                        </a>
                    </div>
                `
            }
        ];

        document.addEventListener("DOMContentLoaded", () => {
            manager.loadTable('tablaPedidos', columnas);
        });
    </script>
}